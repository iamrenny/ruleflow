<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CLI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">rules-cli</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">CLI.java</span></div><h1>CLI.java</h1><pre class="source lang-java linenums">import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.github.iamrenny.ruleflow.listeners.ErrorListener;
import com.github.iamrenny.ruleflow.RuleFlowLanguageLexer;
import com.github.iamrenny.ruleflow.RuleFlowLanguageParser;
import com.github.iamrenny.ruleflow.visitors.RulesetVisitor;
import org.antlr.v4.runtime.CharStreams;
import org.antlr.v4.runtime.CommonTokenStream;
import org.antlr.v4.runtime.tree.ParseTree;

import java.util.HashMap;
import java.util.Map;
import java.util.Set;

<span class="nc" id="L15">public class CLI {</span>

<span class="nc" id="L17">    private final ObjectMapper objectMapper = new ObjectMapper();</span>

    public String evaluate(String inputData, String workflow) {
        try {
            // Convert input JSON data to Map&lt;String, Object&gt;
<span class="nc" id="L22">            JsonNode inputJson = objectMapper.readTree(inputData);</span>
<span class="nc" id="L23">            Map&lt;String, Object&gt; dataMap = objectMapper.convertValue(inputJson, Map.class);</span>

            // Setup ANTLR lexer, parser, and visitor
<span class="nc" id="L26">            var input = CharStreams.fromString(workflow);</span>
<span class="nc" id="L27">            var lexer = new RuleFlowLanguageLexer(input);</span>
<span class="nc" id="L28">            var tokens = new CommonTokenStream(lexer);</span>
<span class="nc" id="L29">            var parser = new RuleFlowLanguageParser(tokens);</span>
<span class="nc" id="L30">            parser.addErrorListener(new ErrorListener());</span>

<span class="nc" id="L32">            ParseTree tree = parser.parse();</span>
<span class="nc" id="L33">            var visitor = new RulesetVisitor(dataMap, new HashMap&lt;&gt;());</span>

            // Visit the tree and return the evaluation result
<span class="nc" id="L36">            return visitor.visit(tree).toString();</span>
<span class="nc" id="L37">        } catch (Exception e) {</span>
<span class="nc" id="L38">            return &quot;Evaluation error: &quot; + e.getMessage();</span>
        }
    }

    private String runRule(String inputData, String rule) {
        try {
<span class="nc" id="L44">            JsonNode inputJson = objectMapper.readTree(inputData);</span>
<span class="nc" id="L45">            Map&lt;String, Object&gt; dataMap = objectMapper.convertValue(inputJson, Map.class);</span>
<span class="nc" id="L46">            return new RuleEvaluator(rule, dataMap, Map.of()).evaluate();</span>
<span class="nc" id="L47">        } catch (Exception e) {</span>
<span class="nc" id="L48">            return &quot;Run error: &quot; + e.getMessage();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>