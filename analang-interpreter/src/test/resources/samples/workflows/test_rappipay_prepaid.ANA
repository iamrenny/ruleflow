workflow 'rappi_pay_prepaid'
    ruleset 'vector_rule_hard_cap'
        'amt_1d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_1d > 30000 return block
        'amt_7d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_7d > 100000 return block
        'amt_transaction' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransaction.amount > 30000 return block
        'qty_1d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_1d > 20 return block
        'qty_6h' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_6h > 10 return block

    ruleset 'card_not_present_hard_cap'
        'amt_transaction' (rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.entryMode.pan.name = 'MANUAL'
            OR rappiPayPrepaidTransaction.entryMode.pan.name = 'UNKNOWN'))
            AND rappiPayPrepaidTransaction.amount > 16000 return block
        'qty_1d' (rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.entryMode.pan.name = 'MANUAL'
            OR rappiPayPrepaidTransaction.entryMode.pan.name = 'UNKNOWN'))
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_1d > 19 return block
        'qty_6h' (rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.entryMode.pan.name = 'MANUAL'
            OR rappiPayPrepaidTransaction.entryMode.pan.name = 'UNKNOWN'))
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_6h > 9 return block
        'amt_7d' (rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.entryMode.pan.name = 'MANUAL'
            OR rappiPayPrepaidTransaction.entryMode.pan.name = 'UNKNOWN'))
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_7d > 60000 return block
        'amt_1d' (rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.entryMode.pan.name = 'MANUAL'
            OR rappiPayPrepaidTransaction.entryMode.pan.name = 'UNKNOWN'))
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_1d > 16000 return block

    ruleset 'vector_rule_hard_cap_international'
        'amt_1d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_1d > 10000 return block
        'amt_7d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_7d > 58000 return block
        'amt_transaction' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND  rappiPayPrepaidTransaction.amount > 9500 return block
        'qty_1d' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_1d > 18 return block
        'qty_6h' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_6h > 8 return block

    ruleset 'vector_rule'
        'velocity' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerMinsSinceLastApprovedTransaction <= 3
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedQty_1h > 3
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerApprovedAmount_1h > 6000 return block
        'high_rejected_ratio' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayTransactionsHistory.RpPayerCcDepositFailureQty_1d + rappiPayTransactionsHistory.RpPayerCcDepositApprovedQty_1d) > 0
            AND (rappiPayTransactionsHistory.RpPayerCcDepositFailureQty_1d / (rappiPayTransactionsHistory.RpPayerCcDepositFailureQty_1d + rappiPayTransactionsHistory.RpPayerCcDepositApprovedQty_1d)) >= 0.7
            AND rappiPayTransactionsHistory.RpPayerCcDepositFailureQty_1d >= 8 return block

    ruleset 'skimming_counterfeit_card'
        'deny' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerMagstripeQty_1h > 1 return block

    ruleset 'copied_card_cash_out_of_fraudulent_funds'
        'deny' (rappiPayPrepaidTransaction.entryMode.pan.name <> 'MANUAL'
            AND rappiPayPrepaidTransaction.entryMode.pan.name <> 'UNKNOWN')
            AND rappiPayTransactionsHistory.RpPayerMinsSinceLastApprovedDeposit <= 30 return block

    ruleset 'potentially_copied_card_foreign_withdraw'
        'deny' (rappiPayPrepaidTransaction.entryMode.pan.name <> 'MANUAL'
            AND rappiPayPrepaidTransaction.entryMode.pan.name <> 'UNKNOWN')
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerWithdrawDistinctCountries_2h >= 2 return block

    ruleset 'potentially_copied_card'
        'deny' (rappiPayPrepaidTransaction.entryMode.pan.name <> 'MANUAL'
            AND rappiPayPrepaidTransaction.entryMode.pan.name <> 'UNKNOWN')
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerInsufficientFundsQty_1d > 3 return block

    ruleset 'decline_attempts_when_above_the_set_limit'
        'deny' (rappiPayPrepaidTransaction.entryMode.pan.name <> 'MANUAL'
            AND rappiPayPrepaidTransaction.entryMode.pan.name <> 'UNKNOWN'
            AND rappiPayPrepaidTransaction.type = 'PURCHASE')
            AND rappiPayPrepaidTransactionsHistory.RpPrepaidPayerFailureQty_1d > 4 return block

    ruleset 'high_risk_location_rule'
        'deny' rappiPayPrepaidTransaction.type = 'PURCHASE'
            AND (rappiPayPrepaidTransaction.location.country = 'gh'
            OR rappiPayPrepaidTransaction.location.country = 'vn'
            OR rappiPayPrepaidTransaction.location.country = 'so'
            OR rappiPayPrepaidTransaction.location.country = 'ng')
            AND rappiPayPrepaidTransaction.amount > 1000 return block

    default allow
end